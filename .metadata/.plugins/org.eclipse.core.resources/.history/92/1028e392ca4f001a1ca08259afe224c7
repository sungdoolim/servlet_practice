package lab.web.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.sql.DataSource;
import Ex.user;
public class userdao {
	static {
		try {
			DriverManager.deregisterDriver(new oracle.jdbc.driver.OracleDriver());
			System.out.println("드라이버 로드 성공");
		
		} catch (Exception e) {
			// TODO: handle exception
			System.out.println(e.getMessage());
		}
	}
	
	
	public Connection getConnection() {
		DataSource ds =null;
		Connection con = null;

	try {
		Context ctx = new InitialContext();
		ds = (DataSource)ctx.lookup("java:comp/env/jdbc/Oracle");
		con= ds.getConnection();
	}catch(Exception e) {
		e.printStackTrace();
	}
	return con;

	}private void closeConnection (Connection con) {
		if(con!=null) {
			try {
				con.close();
			} catch (Exception e) {
				// TODO: handle exception
			
			}
		}
	}
public void insert(user u) {
	Connection con = null;

try {
	con= getConnection();
	String sql = "insert into mem values(?,?,?)";
	
	
	
	PreparedStatement pstmt=con.prepareStatement(sql);


	pstmt.setString(1,u.getName());
	pstmt.setString(2,u.getNum());
	pstmt.setString(3,u.getEmail());
	
	pstmt.executeQuery();
	
}catch(SQLException e) {
	throw new RuntimeException("userdao.insert() :"+ e.getMessage());
}finally {
	closeConnection(con);
}
}
	public user select(String name) {
		Connection con = null;
		user u= new user();
try {
	con = getConnection();
	String sql ="select * from mem where name=?";
	PreparedStatement pstmt = con.prepareStatement(sql);
	pstmt.setString(1, name);
	ResultSet rs = pstmt.executeQuery();
	if(rs.next()) {
		u.setNum("num");
		u.setName(rs.getString("name"));
		u.setEmail("email");
	
	
	}
} catch (SQLException e) {
	
	e.printStackTrace();
	throw new RuntimeException("userdao.select() : "+e.getMessage());
	// TODO: handle exception
}finally {
	closeConnection(con);
}
return u;
	
}


}
